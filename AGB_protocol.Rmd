---
title: "USDA-NRCS Field Bulk Density Protocols"
author: "Andrew G. Brown (andrew.g.brown@usda.gov)"
date: "11/2/2020"
output: html_document
---

```{r setup, echo=FALSE, warning=FALSE, message=FALSE}
knitr::opts_chunk$set(warning=FALSE, message=FALSE, results='asis', echo=FALSE)

library(DT)

# requires local NASIS DB instance
library(RODBC)
con <- soilDB:::.openNASISchannel()


## inspect
# sqlTables(con)

res <- sqlQuery(con, "SELECT * FROM MetadataTable 
                       INNER JOIN MetadataTableColumn ON MetadataTableColumn.TableID = MetadataTable.TableID
                      WHERE TablePhysicalName IN ('phdb','phfmp','phlabresults','phsample')")
reslist <- split(res, res$TablePhysicalName)
odbcClose(con)
```

Bulk density protocols and notes here: [BulkDensityRef](https://drive.google.com/drive/folders/1WATqzxLPXaI2ZB_V6plO7Jj4I9Xi_PkF)

__1) If you are a field soil scientist, what is your decision tree for taking a bulk density measurement?__

For every soil pit that we send off for laboratory characterization, we collect bulk density samples by layer in triplicate. Ideally these are paraffin-coated (intact) clods. In cohesion-less material we use cylindrical or rectangular (known volume) cores or compliant cavity. For organic materials, the lab has suggested the "brownie method" where a rectangle of "known volume" ($x * y * z$) is cut from a pit face with a sharp knife -- this is sometimes less disruptive than the coring tools depending on organic fiber kind and decomposition state.

  The [KSSL Sample Submission Protocol (PDF)](https://www.nrcs.usda.gov/wps/PA_NRCSConsumption/download?cid=stelprdb1267302&ext=pdf) describes how to collect, label and ship samples to Kellog Soil Survey Laboratory in Lincoln, Nebraska. Data generated by our laboratory in Lincoln comprise the bulk of the data in the National Cooperative Soil Survey Characterization (NCSSC) Database.

I will briefly walk through bulk density in NASIS and from perspective of a field soil scientist with NRCS.

Specifically, in this document we will talk about these four tables associated with the NASIS Pedon object.

```{r}
datatable(unique(res[,c("TablePhysicalName","TableDescription")]), rownames = FALSE)
```

- [This document](bulkdensity_graph_demo.html) describes Bulk Density in the National Cooperative Soil Survey Characterization Database

#### Routine soil description

Most of my soil descriptions in NASIS do _not_ have bulk density measurements. 

For specific projects I have collected bulk density samples more frequently. For instance, low bulk density is partially diagnostic for Andisols, Andic Soil Properties and Andic subgroups (volcanic soils). Bulk density measurements on uncharacterized pedons were used to demonstrate the _extent_ of concepts that had been fully laboratory characterized at several other locations. The data collected may be stored in NASIS, but are not in NCSSC database because the profiles were not being fully characterized, and the samples were not sent to the Lincoln lab.

I record these measurements within the NASIS _Pedon Horizon Bulk Density_ `phdb` table. A single record in that table is about the equivalent of 1 rep of `Bulk Density, Core, <2 mm fraction, Field Moist` or `db_fmstc` in the NCSSC `analyte` table.

Note that the `phdb` table has columns to store data for sieving out coarse fragments and accounting for their volume, determining moisture content and also calculated values of mass per volume field-moist, oven-dry (whole soil) and oven-dry (sieved). 

```{r}
table_column_show <- c("TablePhysicalName","ColumnPhysicalName","ColumnDescription")

datatable(reslist$phdb[,table_column_show], 
  rownames = FALSE, caption = "phdb Table")
```

In the past the free-form _Pedon Horizon Field Measured Property_ table `phfmp` had been used for bulk density measurements, so there is bulk density data in there. 

```{r}
datatable(reslist$phfmp[,table_column_show], rownames = FALSE, caption = " phfmp Table")
```

Note that in _Field Measured Property_ the name and unit of measure are free-form text fields. Measures are made as needed based on region, soil type, and project scope -- and there are few to no limits on what you can put in there by design. Note that in modern NASIS, there is a proper place for most common measurements used for soil survey activities -- so it is pretty rare that new data are put in that table. Bulk density gets its own table, but there is also the _Pedon Horizon Lab Results_ table.

The _Pedon Horizon Lab Results_ `phlabresults` table includes attributes that are commonly measured by the "field" laboratories operated in local Soil Survey Offices. There are three child tables of _Lab Results_ related to hydrometer particle size analysis, COLE, and mineral grain count. Many of these are important to soil interpretations, taxonomy or both and may be measured by a variety of sources depending on the needs of the soil survey. Like `phdb`,  `phlabresults` provides a mechanism to account for subsampling layers; `sampledepthtop` and `sampledepthbottom` need not match the top and bottom depth of the horizon they came from.

```{r}
datatable(reslist$phlabresults[,table_column_show],
  rownames = FALSE, caption = "Physical Column Names in phlabresults Table")
```

---

#### Laboratory sampling

We are starting a new dynamic soil properties project in our office where we will be tracking the effects of vegetation removal for fire suppression on soil properties. This will involve laboratory characterization and a particular focus on properties like near-surface bulk density. 

When we do that sampling we will enter our field descriptions from the sampling day into NASIS, and we will fill out the _Pedon Horizon Sample_ table. There is a field here to note how many bulk sample bags and the number of bulk density clods were collected for each layer (`labsampnum`) that gets sent to Lincoln. Note also that it is implied that the 20-76mm rock fragments have been _removed_ from bulk sample bags and weighed in the field. A volumetric correction is applied later for "Whole Soil" conversions on the whole coarse fraction.

```{r}
datatable(reslist$phsample[,table_column_show],
  rownames = FALSE, caption = "Physical Column Names in phsample Table")
```

Note that data brought in to NASIS from the KSSL laboratory snapshot is stored in the _NCSS Pedon Lab Data_ and _NCSS Layer Lab Data_ tables in NASIS. These are different from the pedon data tables where primary soil observations by Soil Survey Offices are stored.

__2) If you are soil data user, how do you identify ‘usable’ bulk density data in a database/dataset?__

Generally, I am happy if bulk density input data (masses, core volume, etc.) and method are provided -- rather than baked into the results. 

I look to the schema of the database, table names and/or column names to find where and how primary measurements are stored. Bulk density technically is a combination of several physical measurements, some of which may be assumed constant for e.g. a given core tool. The way that the soils were sampled and aggregated should be obvious. This level of granularity may not be present in a single dataset, but I generally go to the finest level of aggregation (i.e. individual reps/summary stats or constituent measurements)

I also want to know what soil volume each sample or set of samples is supposed to be summarizing; and consider this along with the volume of the sampling device/method. The geometry is typically a top and bottom depth for a 1-D profile description, but detailed descriptions in e.g. cryoturbated materials may have more complicated geometry.  


